{"ast":null,"code":"import { hashQueryKeyByOptions, parseFilterArgs, matchQuery } from './utils.mjs';\nimport { Query } from './query.mjs';\nimport { notifyManager } from './notifyManager.mjs';\nimport { Subscribable } from './subscribable.mjs';\n\n// CLASS\nclass QueryCache extends Subscribable {\n  constructor(config) {\n    super();\n    this.config = config || {};\n    this.queries = [];\n    this.queriesMap = {};\n  }\n  build(client, options, state) {\n    var _options$queryHash;\n    const queryKey = options.queryKey;\n    const queryHash = (_options$queryHash = options.queryHash) != null ? _options$queryHash : hashQueryKeyByOptions(queryKey, options);\n    let query = this.get(queryHash);\n    if (!query) {\n      query = new Query({\n        cache: this,\n        logger: client.getLogger(),\n        queryKey,\n        queryHash,\n        options: client.defaultQueryOptions(options),\n        state,\n        defaultOptions: client.getQueryDefaults(queryKey)\n      });\n      this.add(query);\n    }\n    return query;\n  }\n  add(query) {\n    if (!this.queriesMap[query.queryHash]) {\n      this.queriesMap[query.queryHash] = query;\n      this.queries.push(query);\n      this.notify({\n        type: 'added',\n        query\n      });\n    }\n  }\n  remove(query) {\n    const queryInMap = this.queriesMap[query.queryHash];\n    if (queryInMap) {\n      query.destroy();\n      this.queries = this.queries.filter(x => x !== query);\n      if (queryInMap === query) {\n        delete this.queriesMap[query.queryHash];\n      }\n      this.notify({\n        type: 'removed',\n        query\n      });\n    }\n  }\n  clear() {\n    notifyManager.batch(() => {\n      this.queries.forEach(query => {\n        this.remove(query);\n      });\n    });\n  }\n  get(queryHash) {\n    return this.queriesMap[queryHash];\n  }\n  getAll() {\n    return this.queries;\n  }\n  find(arg1, arg2) {\n    const [filters] = parseFilterArgs(arg1, arg2);\n    if (typeof filters.exact === 'undefined') {\n      filters.exact = true;\n    }\n    return this.queries.find(query => matchQuery(filters, query));\n  }\n  findAll(arg1, arg2) {\n    const [filters] = parseFilterArgs(arg1, arg2);\n    return Object.keys(filters).length > 0 ? this.queries.filter(query => matchQuery(filters, query)) : this.queries;\n  }\n  notify(event) {\n    notifyManager.batch(() => {\n      this.listeners.forEach(({\n        listener\n      }) => {\n        listener(event);\n      });\n    });\n  }\n  onFocus() {\n    notifyManager.batch(() => {\n      this.queries.forEach(query => {\n        query.onFocus();\n      });\n    });\n  }\n  onOnline() {\n    notifyManager.batch(() => {\n      this.queries.forEach(query => {\n        query.onOnline();\n      });\n    });\n  }\n}\nexport { QueryCache };","map":{"version":3,"names":["hashQueryKeyByOptions","parseFilterArgs","matchQuery","Query","notifyManager","Subscribable","QueryCache","constructor","config","queries","queriesMap","build","client","options","state","_options$queryHash","queryKey","queryHash","query","get","cache","logger","getLogger","defaultQueryOptions","defaultOptions","getQueryDefaults","add","push","notify","type","remove","queryInMap","destroy","filter","x","clear","batch","forEach","getAll","find","arg1","arg2","filters","exact","findAll","Object","keys","length","event","listeners","listener","onFocus","onOnline"],"sources":["C:/Users/gregor.woiwode/workbench/talks/talk-qwik-angular/node_modules/.pnpm/@tanstack+query-core@4.32.0/node_modules/@tanstack/query-core/build/lib/queryCache.mjs"],"sourcesContent":["import { hashQueryKeyByOptions, parseFilterArgs, matchQuery } from './utils.mjs';\nimport { Query } from './query.mjs';\nimport { notifyManager } from './notifyManager.mjs';\nimport { Subscribable } from './subscribable.mjs';\n\n// CLASS\nclass QueryCache extends Subscribable {\n  constructor(config) {\n    super();\n    this.config = config || {};\n    this.queries = [];\n    this.queriesMap = {};\n  }\n\n  build(client, options, state) {\n    var _options$queryHash;\n\n    const queryKey = options.queryKey;\n    const queryHash = (_options$queryHash = options.queryHash) != null ? _options$queryHash : hashQueryKeyByOptions(queryKey, options);\n    let query = this.get(queryHash);\n\n    if (!query) {\n      query = new Query({\n        cache: this,\n        logger: client.getLogger(),\n        queryKey,\n        queryHash,\n        options: client.defaultQueryOptions(options),\n        state,\n        defaultOptions: client.getQueryDefaults(queryKey)\n      });\n      this.add(query);\n    }\n\n    return query;\n  }\n\n  add(query) {\n    if (!this.queriesMap[query.queryHash]) {\n      this.queriesMap[query.queryHash] = query;\n      this.queries.push(query);\n      this.notify({\n        type: 'added',\n        query\n      });\n    }\n  }\n\n  remove(query) {\n    const queryInMap = this.queriesMap[query.queryHash];\n\n    if (queryInMap) {\n      query.destroy();\n      this.queries = this.queries.filter(x => x !== query);\n\n      if (queryInMap === query) {\n        delete this.queriesMap[query.queryHash];\n      }\n\n      this.notify({\n        type: 'removed',\n        query\n      });\n    }\n  }\n\n  clear() {\n    notifyManager.batch(() => {\n      this.queries.forEach(query => {\n        this.remove(query);\n      });\n    });\n  }\n\n  get(queryHash) {\n    return this.queriesMap[queryHash];\n  }\n\n  getAll() {\n    return this.queries;\n  }\n\n  find(arg1, arg2) {\n    const [filters] = parseFilterArgs(arg1, arg2);\n\n    if (typeof filters.exact === 'undefined') {\n      filters.exact = true;\n    }\n\n    return this.queries.find(query => matchQuery(filters, query));\n  }\n\n  findAll(arg1, arg2) {\n    const [filters] = parseFilterArgs(arg1, arg2);\n    return Object.keys(filters).length > 0 ? this.queries.filter(query => matchQuery(filters, query)) : this.queries;\n  }\n\n  notify(event) {\n    notifyManager.batch(() => {\n      this.listeners.forEach(({\n        listener\n      }) => {\n        listener(event);\n      });\n    });\n  }\n\n  onFocus() {\n    notifyManager.batch(() => {\n      this.queries.forEach(query => {\n        query.onFocus();\n      });\n    });\n  }\n\n  onOnline() {\n    notifyManager.batch(() => {\n      this.queries.forEach(query => {\n        query.onOnline();\n      });\n    });\n  }\n\n}\n\nexport { QueryCache };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}